<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Employee Dashboard</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
<div class="dashboard">
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <svg class="icon-lg" style="color:#4f46e5;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
                <div><h1>Employee Dashboard</h1><p class="subtitle" id="employeeSubtitle">Welcome</p></div>
            </div>
            <div class="header-right">
                <button class="btn-primary" onclick="goToAnalytics()" style="background:#059669;margin-right:0.5rem;">
                    ðŸ“Š Analytics
                </button>
                <button class="btn-danger" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </div>
 
    <div class="container py-8">
        <div class="stats-grid" style="display:flex;gap:1rem;margin-bottom:1.5rem;">
            <div class="stat-card"><p class="stat-label">Total Items</p><p class="stat-value" id="totalItems" style="color:#4f46e5;"></p></div>
            <div class="stat-card"><p class="stat-label">Total Inventory Value</p><p class="stat-value" id="totalValue" style="color:#059669;"></p></div>
            <div class="stat-card"><p class="stat-label">Low Stock Items</p><p class="stat-value" id="lowStock" style="color:#dc2626;"></p></div>
        </div>
 
        <div class="controls">
            <div class="controls-row">
                <div class="search-wrapper">
                    <svg class="icon input-icon" style="left:0.75rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" id="searchInput" class="input-with-icon" placeholder="Search by name or brand...">
                </div>
                <select id="categoryFilter">
                    <option>All</option><option>CPU</option><option>GPU</option><option>RAM</option><option>Storage</option><option>Motherboard</option><option>PSU</option><option>Case</option>
                </select>
                <button class="btn-primary" onclick="openAddForm()">Add Item</button>
            </div>
        </div>
 
        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Name</th><th>Category</th><th>Brand</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead>
                    <tbody id="inventoryTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
 
<!-- Add Modal -->
<div id="addModal" class="modal-overlay hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:1rem;">
    <div class="modal" style="background:white;border-radius:0.5rem;max-width:42rem;padding:1.5rem;">
        <div class="modal-header"><h2>Add New Item</h2><button class="modal-close" onclick="document.getElementById('addModal').classList.add('hidden')">Ã—</button></div>
        <form id="addForm">
            <div class="form-group"><label>Name</label><input name="name" required></div>
            <div class="form-group"><label>Category</label><select name="category"><option>CPU</option><option>GPU</option><option>RAM</option><option>Storage</option><option>Motherboard</option><option>PSU</option><option>Case</option></select></div>
            <div class="form-group"><label>Brand</label><input name="brand" required></div>
            <div class="form-group"><label>Price</label><input type="number" step="0.01" name="price" required></div>
            <div class="form-group"><label>Stock</label><input type="number" name="stock" required></div>
            <div class="form-group"><label>Description</label><textarea name="description" rows="3" required></textarea></div>
            <div class="modal-actions" style="display:flex;gap:0.75rem;margin-top:1rem;"><button type="button" class="btn-secondary" onclick="document.getElementById('addModal').classList.add('hidden')">Cancel</button><button type="submit" class="btn-primary">Add Item</button></div>
        </form>
    </div>
</div>
 
<!-- Edit Modal -->
<div id="editModal" class="modal-overlay hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:1rem;">
    <div class="modal" style="background:white;border-radius:0.5rem;max-width:42rem;padding:1.5rem;">
        <div class="modal-header"><h2>Edit Item</h2><button class="modal-close" onclick="document.getElementById('editModal').classList.add('hidden')">Ã—</button></div>
        <form id="editForm">
            <input type="hidden" name="id">
            <div class="form-group"><label>Name</label><input name="name" required></div>
            <div class="form-group"><label>Category</label><select name="category"><option>CPU</option><option>GPU</option><option>RAM</option><option>Storage</option><option>Motherboard</option><option>PSU</option><option>Case</option></select></div>
            <div class="form-group"><label>Brand</label><input name="brand" required></div>
            <div class="form-group"><label>Price</label><input type="number" step="0.01" name="price" required></div>
            <div class="form-group"><label>Stock</label><input type="number" name="stock" required></div>
            <div class="form-group"><label>Description</label><textarea name="description" rows="3" required></textarea></div>
            <div class="modal-actions" style="display:flex;gap:0.75rem;margin-top:1rem;"><button type="button" class="btn-secondary" onclick="document.getElementById('editModal').classList.add('hidden')">Cancel</button><button type="submit" class="btn-primary">Save Changes</button></div>
        </form>
    </div>
</div>
 
<script src="../../js/state.js"></script>
<script src="../../js/utils.js"></script>
<script src="../../js/inventory.js"></script>
<script>
function goToAnalytics() {
    window.location.href = '/Frontend/Analytics.html';
}

async function initialize() {
    await loadCurrentUser();
    if (!STATE.currentUser || STATE.currentUser.role !== 'employee') {
        window.location.href = '/Frontend/index.html';
        return;
    }
    document.getElementById('employeeSubtitle').textContent = 'Welcome, ' + STATE.currentUser.name;
    await loadInventory();
    updateStats();
    renderInventoryTable();
}

function updateStats(){
    document.getElementById('totalItems').textContent = STATE.inventory.length;
    const totalValue = STATE.inventory.reduce((s,i)=>s + i.price*i.stock,0);
    document.getElementById('totalValue').textContent = 'â‚±' + totalValue.toFixed(2);
    document.getElementById('lowStock').textContent = STATE.inventory.filter(i=>i.stock<10).length;
}

// Override renderInventoryTable to show PHP currency
function renderInventoryTable() {
    const tbody = document.getElementById('inventoryTbody');
    if (!tbody) return;

    const searchText = (document.getElementById('searchInput')?.value || '').toLowerCase();
    const category = document.getElementById('categoryFilter')?.value || 'All';
    
    const filtered = STATE.inventory.filter(item => {
        const matchesSearch = item.name.toLowerCase().includes(searchText) || 
                            item.brand.toLowerCase().includes(searchText);
        const matchesCategory = category === 'All' || item.category === category;
        return matchesSearch && matchesCategory;
    });

    tbody.innerHTML = filtered.map(item => `
        <tr>
            <td>${item.name}</td>
            <td><span class="badge badge-primary">${item.category}</span></td>
            <td>${item.brand}</td>
            <td>â‚±${item.price.toFixed(2)}</td>
            <td><span class="badge ${item.stock < 10 ? 'badge-danger' : 'badge-success'}">${item.stock}</span></td>
            <td>
                <button class="btn-icon" onclick="openEditForm('${item.id}')" title="Edit">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                </button>
                <button class="btn-icon" onclick="confirmDelete('${item.id}')" title="Delete">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </td>
        </tr>
    `).join('');
}

document.getElementById('searchInput').addEventListener('input', renderInventoryTable);
document.getElementById('categoryFilter').addEventListener('change', renderInventoryTable);
document.getElementById('addForm').addEventListener('submit', function(e){ handleAddSubmit(e); updateStats(); });
document.getElementById('editForm').addEventListener('submit', function(e){ handleEditSubmit(e); updateStats(); });

initialize();
</script>
</body>
</html>