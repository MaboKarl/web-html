<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Buyer Dashboard</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="dashboard">
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <svg class="icon-lg" style="color:#4f46e5;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
                <div><h1>Buyer Dashboard</h1><p class="subtitle" id="buyerSubtitle">Welcome</p></div>
            </div>
            <div class="header-right">
                <button class="btn-primary" onclick="document.getElementById('cartModal').classList.remove('hidden')">Cart (<span id="cartCount">0</span>)</button>
                <button class="btn-danger" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="container py-8">
        <div class="controls">
            <div class="controls-row">
                <div class="search-wrapper">
                    <svg class="icon input-icon" style="left:0.75rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" id="searchInput" class="input-with-icon" placeholder="Search by name or brand...">
                </div>
                <select id="categoryFilter">
                    <option>All</option><option>CPU</option><option>GPU</option><option>RAM</option><option>Storage</option><option>Motherboard</option><option>PSU</option><option>Case</option>
                </select>
            </div>
        </div>

        <div id="productsGrid" class="product-grid"></div>
        <div id="noItems" class="empty-state hidden">No items found matching your search criteria.</div>
    </div>
</div>

<!-- Add to Cart Modal -->
<div id="addToCartModal" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:1rem;">
    <div class="modal" style="background:white;border-radius:0.5rem;max-width:42rem;padding:1.5rem;">
        <h2 class="modal-title">Item</h2>
        <p class="modal-price"></p>
        <div class="form-group"><label>Quantity</label><input id="addQty" type="number" min="1" value="1"></div>
        <div style="display:flex;gap:0.75rem;"><button class="btn-secondary" onclick="document.getElementById('addToCartModal').classList.add('hidden')">Cancel</button><button class="btn-primary" onclick="confirmAddToCartFromModal()">Add to Cart</button></div>
    </div>
</div>

<!-- Cart Modal -->
<div id="cartModal" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:1rem;">
    <div class="modal" style="background:white;border-radius:0.5rem;max-width:42rem;padding:1.5rem;">
        <div class="modal-header"><h2>Shopping Cart</h2><button class="modal-close" onclick="document.getElementById('cartModal').classList.add('hidden')">Ã—</button></div>
        <div id="cartPreview" style="max-height:50vh;overflow:auto;padding:1rem;"></div>
        <div style="margin-top:1rem;display:flex;gap:0.75rem;">
            <button class="btn-secondary" onclick="document.getElementById('cartModal').classList.add('hidden')">Close</button>
            <button class="btn-primary" onclick="checkoutCart()">Checkout</button>
        </div>
    </div>
</div>

<script src="js/state.js"></script>
<script src="js/utils.js"></script>
<script src="js/cart.js"></script>
<script>
loadCurrentUser();
if (!STATE.currentUser || STATE.currentUser.role !== 'buyer') {
    window.location.href = 'index.html';
}
document.getElementById('buyerSubtitle').textContent = 'Welcome, ' + STATE.currentUser.name;
renderProductsGrid();
renderCartPreview();
document.getElementById('searchInput').addEventListener('input', function(){ renderProductsGrid(); renderCartPreview(); updateCartCount(); });
document.getElementById('categoryFilter').addEventListener('change', function(){ renderProductsGrid(); renderCartPreview(); updateCartCount(); });

function updateCartCount(){
    document.getElementById('cartCount').textContent = STATE.cart.reduce((s,i)=>s+i.quantity,0);
}
setInterval(updateCartCount,500);
</script>
</body>
</html>
